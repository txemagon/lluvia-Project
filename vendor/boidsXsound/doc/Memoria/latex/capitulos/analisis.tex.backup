\section{Análisis}
\label{section:analisis}

\subsection{El mundo}
Siendo el objetivo principal del proyecto crear un banco de pruebas para la medición del estrés en manadas de entidades autónomas por medio del sistema auditivo, reproduciremos el modelo propuesto por Craig W. Reynolds en su trabajo “Steering Behaviors For Autonomous Characters” para la creación de dichos agentes autónomos.
 
Para que las entidades puedan existir es necesario crear previamente un espacio con ciertas características donde puedan cohabitar grupos de dichas entidades.
 
Para ello, se creará un mundo en dos dimensiones (x,y) con una perspectiva de planta para su representación gráfica. La coordenada (0,0) se situará en la esquina superior izquierda del canvas.
 
El mundo contará con un tiempo inicial y actual, esta magnitud medible es necesaria para el correcto funcionamiento del sistema. Con ella la velocidad máxima de ciclos de procesamiento dependerá del aumento del tiempo y no de la velocidad propia que pueda alcanzar el procesador principal del sistema. Esto es de suma importancia porque proporciona una independencia a la hora de ejecutar la aplicación en diferentes sistemas con diferentes capacidades de calculo.
 
Dispondrá de un largo y ancho para su representación gráfica pero en la práctica y a la hora de realizar cálculos no tendrá ninguna limitación de tamaño, esto permite una gran libertad a la hora de realizar diferentes comportamientos por las entidades, la representación gráfica solo es una ventana donde poder observar todo lo que ocurre en el sistema.
 
Se podrán marcar algunas reglas físicas para adecuar el mundo virtual al real o caracterizarlo de cierta manera. Se podrá acotar la velocidad máxima y la aceleración máxima que pueden alcanzar las entidades, entre otras cosas.
 
El mundo dispondrá de una lista de todas las entidades y objetos que se encuentren dentro del mismo. Gracias a esto, será más fácil el cálculo y programación de comportamientos, además de, para labores de optimización de la aplicación.
 
Los objetos u obstáculos se definirán con líneas rectas y se podrán formar figuras geométricas con ellas.  Esto da la posibilidad desde crear recintos para acotar el espacio de movimiento a crear obstáculos para definir caminos o simplemente para que sean evitados.
 
\subsection{Nanobot}
\label{sec:nanobot}

Cada nanobot sera una entidad que percibe su entorno y que podrá ser capaz de actuar en consecuencia decidiendo que hacer por medio de unas reglas de logica propias del modelo. [Figura 1]

Gracias a esto cada nanobot del grupo poseera cierto nivel de inteligencia, sera capaz de actuar de manera autonoma y  tener un nivel complejo de predictibilidad  a largo plazo. Al no tratarse de un sistema ideal toda la informacion que le llegue sera acotada para simular un entorno real, es decir, tanto su sistema visual y auditivo seran finitos y acordes a los animales que representen.

\subsubsection{Caracterísicas básicas}
\label{sec:caracteristicas_basicas}

\noindent Las principales características de los Nanobots son:  
\begin{itemize}
 \item  Cerebro: En el cerebro se gestionan todos los comportamientos. Se dispondra de una lista de la cual se podra elegir el comportamiento adecuado en cada momento para el correcto funcionamiento del modelo. Tambien se podran activar mas de un comportamiento dando lugar a otros comportamientos mas complejos e impredecibles. Sera capaz de saber cual es la aceleracion adecuada para poder variar la velocidad de manera correcta. Esto se realizara haciendo la media de todas las aceleraciones devueltas por los comportamientos y en funcion de esa aceleracion la velocidad de la entidad se adecuara a la situacion actual.
 \item Geo data: Se debe conocer en todo momento la posicion del nanobot, asi como, su velocidad y aceleraccion. Imprescindible para poder realizar todos los calculos de los comportamientos y de su representacion grafica. Estas tres magnitudes seran representadas por vectores de dos dimensiones al igual que el mundo.
 \item Masa: Es la cantidad de materia que posee cada entidad. Necesaria para calcular la inercia mecánica del movil. 
 \item Visión: Define el ángulo y radio de vision. Con ello se podra calcular todas las entidades que son susceptibles a ser vistas.
 \item Dirección: Con ella se podrá determinar la dirección en la que mira el nanobot, será calculada como el vector unitario del vector velocidad.
 \item Límites de la fuerzas: Cada entidad poseerá unos límites físicos para la correcta simulación del modelo, se busca con estos límites dotar de realismo a la simulación. Estos limites son:
 \begin{itemize}
   \item Aceleración: Sólo sera posible una aceleración máxima. Superada esa aceleración se volverá inmediatamente a la aceleración máxima.
   \item Giro: Determina el angulo máximo de giro.
   \item Frenado: Máxima fuerza de frenado que podrá ejercer el nanobot. 
 \end{itemize}	
 \item Velocidad máxima: En todo momento se debe revisar el valor de la velocidad, si el módulo del vector velocidad es mayor que la velocidad máxima impuesta, esta se reducira inmediatamente.
 \item Nivel de estres: Se dispone de un sistema para medir el estres del sujeto. Con él, se podra definir un nivel de estres en funcion de todo lo que escuche, desde musica a otros nanobots.
 \item Distancia que recorre la onda de sonido: al poder producir sonido, se define una distancia maxima a la que el sonido producido puede llegar.
\end{itemize}


\subsubsection{Visión}
\label{sec:vision}

Cada entidad posee un campo de vision que esta determinado por un radio de vision y un angulo[Figura 2]. Estos dos valores podran ser parametrizados para observar diferentes reacciones y comportamientos. 

Para la obtencion de las entidades locales que es capaz de visualizar se realizara una resta de los vectores de posicion desde el origen de coordenadas de cada integrante del mundo con respecto al observador, si la distancia es menor al radio de vision es un objeto o entidad susceptible a ser observada , para asegurarlo se realizara ademas una segunda comprobacion con respecto al angulo que forma con la otra entidad, si este  es menor al angulo de vision es un objeto que es visualizado por la entidad.


\subsubsection{Audición}
\label{sec:audicion}

Cada entidad poseerá un sistema auditivo que hará posible el sentido del oido, es decir, lo faculta para ser sensible a los sonidos. La funcion principal de esto sera transformar las ondas sonoras que se propagan por el aire en informacion que capta la entidad y transmite al cerebro para su procesamiento y posterior reacción.


\subsubsection{Sistema de comportamientos}
\label{sec:sistema_comportamientos}

La principal regla en el sistema de comportamientos se basa en la ausencia de una inteligencia que domine a todas las entidades o sobresalga del grupo. Lo contrario invalida el modelo computacional y lo hace carente de sentido para su estudio. Al tener todos los nanobots un nivel similar de inteligencia ayuda a la hora de calcular, estudiar y medir los patrones de bandadas que pueden llegar a formar con las diferentes  ponderaciones que se pueden realizar a sus atributos basicos. Siendo este el motivo principal de estudio del presente proyecto.\\

\noindent\textbf{Comportamientos de manada}

Son las reglas básicas por las que entidades independientes se comportarán de manera similar a manadas de animales reales. Estas reglas son:
\begin{itemize}
 \item Alineación: Se busca que todas las entidades tengan una direccion común. Para ello, se obtiene la velocidad de todas las entidades vecinas y se calcula su promedio, dicho promedio será la velocidad deseada [Figura 3].
 \item Cohesión: Las entidades se mantienen unidas, es decir, se busca que los nanobots no se separen con respecto a una distancia maxima. Para ello, se buscan las posiciones de las entidades vecinas y el promedio de esas posiciones sera el punto que seguira cada nanobot para mantener la unidad [Figura 4].
 \item Separación: Las entidades buscan una separación mínima con su vecinas. Por eso se busca la distancia de separacion de las entidades con respecto al observador. Mientras esa distancia sea grande la fuerza de repulsion sera pequeña y viceversa, a una distancia muy pequeña la fuerza sera muy grande [Figura 5].
\end{itemize}

\paragraph{Comportamientos individuales}
Se basan en acciones específicas para cada entidad en particular, son:  
\begin{itemize}
 \item Seguir: El nanobot buscará la última posición en la que se encuentre su objetivo. Se calculará una velocidad deseada que será el resultado de escalar el vector unitario de la distancia entre perseguidor y objetivo por la velocidad máxima. Para posteriormente calcular la aceleración deseada restando a la velocidad deseada la velocidad actual [Figura 6]. 
 \item Alejarse: Se trata del comportamiento inverso a seguir. Se realizará el mismo cálculo pero al resultado se le cambiara el signo [Figura 7]. 
 \item Perseguir: El nanobot buscará una futura posición en el tiempo en la que se encuentre su objetivo. Se calculará una velocidad deseada que será el resultado de escalar el vector unitario de la distancia entre perseguidor y la posición futura del objetivo por la velocidad máxima. Para posteriormente calcular la aceleración deseada restando a la velocidad deseada la velocidad actual [Figura 8].
 \item Huir: Se trata del comportamiento inverso a perseguir. Se realizará el mismo cálculo pero al resultado se le cambiara el signo [Figura 9]. 
 \item Evitar obstaculos: Cada nanobot será capaz de evitar obstáculos que se encuentre en su camino. Para ello, se creará una línea imaginaria que es idéntica al vector velocidad que lleve en ese momento. Si esa línea imaginaria intersecta con cualquier línea que esté definida en el mundo para crear obstáculos, la aceleración deseada será el vector normal a la velocidad [Figura 10]. 
 \item Vagar: Permite a los nanobots vagar libremente por el mundo sin un rumbo fijo y sin dar cambios bruscos de dirección. Se calculará una velocidad deseada que será el resultado de escalar el vector unitario de la distancia entre el nanobot y  un punto aleatorio  por la velocidad máxima. Para posteriormente calcular la aceleración deseada restando a la velocidad deseada la velocidad actual [Figura 11].  
\end{itemize}

\subsubsection{Toma de decisiones}
\label{sec:toma_decisiones}
La aplicación de cada uno de los comportamientos nos indicará hacia donde se debe dirigir el nanobot, al darse la posibilidad de tener activados tantos comportamientos como se deseen o necesiten, la toma de decision que se realizará será la media de la suma de cada uno de los comportamientos, dando como resultado una aceleración vectorial que influirá en la velocidad de la entidad [Figura 12].

\subsubsection{Comunicación oral}
\label{sec:comunicacion_oral}

Cada entidad será capaz de comunicarse con sus semejantes en un determinado radio.  Cada nanobot podrá mandar mensajes, siendo así el emisor, susceptibles a ser recibidos por todos los nanobot que se encuentre en el radio de la onda sonora, convirtiéndolos en los receptores del mensaje. Se debe diferenciar el receptor del emisor para que al responder no se produzca un efecto en cadena si otro está escuchando.

Existen dos tipos diferentes de comunicaciones:
\begin{itemize}
 \item Comunicación simple: Donde solo se intercambian palabras para poder modificar de manera muy rápida el nivel de estrés del receptor. No hay posibilidad de una segunda réplica por parte del emisor. 
 \item Comunicación ligada a una orden: Se trata de comunicar una orden directa a todas los nanobots que esten escuchando. Estas entidades la procesaran y la llevaran a cabo inmediatamente después.  
\end{itemize}

De esta forma estarán capacitados para poder comunicarse de una manera simple. 

\subsubsection{Nivel de estrés }
\label{sec:nivel_estres}
Cada nanobot poseera un nivel de estrés para reaccionar de acuerdo a el. Según el nivel de estrés  ciertos valores basicos del nanobot cambiaran. Los valores susceptibles a ser modificados son:  ángulo de visión, capacidad de giro, frenado, aceleración y velocidad máxima. 


\subsection{Speaker}
Un speaker, o altavoz, es la simulación de un transductor electroacústico que se utiliza para la reproducción de sonido. Cada speaker es capaz de reproducir canciones de una lista de reproducción, estas canciones serán analizadas a la hora de ser reproducidas. Todas las entidades que escuchen al speaker recibirán la frecuencia del sonido y la interpretaran según sea conveniente.
 
Un speaker será capaz de estar, o no, encendido. Al encenderlo se reproducirá la canción que este actualmente seleccionada, existiendo además una opción para poder pasar a la siguiente canción.
 
También se podrá aumentar, o disminuir, el volumen general del speaker. Con ello variará, no sólo, el volumen de la canción, sino también el radio de alcance de la onda sonora. Con esto se podrá crear diferentes zonas de influencia de la música, con todas las posibilidades de experimentación que ello conlleva.

\subsection{Flujo de trabajo de la aplicación}
La aplicacion se encontrara dentro de un bucle infinito desde el comienzo de la misma hasta su final. El proceso será el siguiente:
\begin{enumerate}
 \item Inicio de la iteración.
 \item El mundo actualiza su tiempo y llama a cada nanobot.
 \item Cada nanobot comprueba si recibe algún estímulo externo, si lo recibe almacena la información de dichos estímulos.
 \item Se actualiza las variables según dichos estímulos para cada nanobot.
 \item Cada nanobot realiza los cálculos para llevar a cabo los comportamientos activos según las variables actuales, para terminar devolviendo una nueva aceleración.
 \item Se calcula la velocidad final para cada nanobot según la aceleración, para poder determinar la nueva posición.
 \item Se pinta el mundo y todos los nanobots en pantalla según la posición recién calculada.
 \item Termina la iteración y vuelve a empezar el bucle.
\end{enumerate}

 





